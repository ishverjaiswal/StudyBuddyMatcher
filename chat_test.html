<!DOCTYPE html>
<html>
<head>
    <title>StudyBuddy Chat Test</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        .message { margin: 5px 0; padding: 5px; border-radius: 5px; }
        .sent { background-color: #e3f2fd; text-align: right; }
        .received { background-color: #f5f5f5; }
        input, button { padding: 10px; margin: 5px; }
        #messageInput { width: 300px; }
    </style>
</head>
<body>
    <h1>StudyBuddy Chat Test</h1>
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Type a message">
    <button onclick="sendMessage()">Send</button>
    <button onclick="joinRoom()">Join Room</button>

    <script>
        const socket = io('http://localhost:5000');
        const messagesDiv = document.getElementById('messages');
        
        socket.on('connect', () => {
            addMessage('System', 'Connected to server', 'system');
        });
        
        socket.on('receive_message', (data) => {
            addMessage('Buddy', data.message, 'received');
        });
        
        socket.on('user_joined', (data) => {
            addMessage('System', `User ${data.userId} joined`, 'system');
        });
        
        socket.on('user_typing', (data) => {
            if (data.isTyping) {
                document.getElementById('typingIndicator').style.display = 'block';
            } else {
                document.getElementById('typingIndicator').style.display = 'none';
            }
        });
        
        function addMessage(sender, message, type) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${type}`;
            messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function joinRoom() {
            const roomId = prompt('Enter room ID (e.g., chat_user1_user2):');
            if (roomId) {
                socket.emit('join_room', { room: roomId, userId: 'testUser' });
                addMessage('System', `Joined room: ${roomId}`, 'system');
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value;
            if (message) {
                const roomId = prompt('Enter room ID (e.g., chat_user1_user2):');
                if (roomId) {
                    socket.emit('send_message', {
                        senderId: 'testUser',
                        message: message,
                        room: roomId
                    });
                    addMessage('Me', message, 'sent');
                    input.value = '';
                }
            }
        }
    </script>
    
    <div id="typingIndicator" style="display: none; color: #666; font-style: italic;">
        User is typing...
    </div>
</body>
</html>